TODO LIST -*- mode: org; -*-

A mixture of things to do, things which might be nice to do, and things which
have been done.  Order is arbitrary. Check
https://internal.fmrib.ox.ac.uk/i-wiki/Analysis/Todos/FSLView regularly, too.


* Bugs to fix
** 'World location' should always be defined by the NIFTI affine transformation
Currently your 'world coordinate system is equivalent to the display
coordinate system. You need to ensure that all displayed 'world coordinates'
are the ones generated by the image affine transformation matrix.
** Linux/Jalapeno Bad window crash
** No worky in VNC session.
** WX Bugs
*** Floating panels get moved about when opening a new floating panel.
*** Make range widget limit buttons expand properly. Ugh. Works fine under linux. This looks like an OSX Mavericks bug.
*** Wild cards in image file load (WX/OSX issue)
** OSMesa render doesn't like circle voxels
** DONE Ortho anatomical labels not being refreshed
** DONE Cursor location in lightbox can be out of the slices
** DONE LightBox screwy on image transformation change
** DONE Slice changes on ludo's bad image, when using pixdim transformation.
** DONE Cursor location moving along other dimensions on X canvas mouse movement in Ludo's bad image.
** DONE ImageListPanel checkbox background colour not resetting
** DONE Image Display Panel seems to get confused sometimes
** DONE Image Select Panel buttons not enabled/disabled properly
** DONE Default value for zax when not specified on command line
** DONE Exceptions thrown on empty image name
** DONE ColourBarPanel assumes that len(imageList) > 0
** DONE is av.nii.gz being displayed properly? Yep, it's interpolation causing a bit of weirdness, but it is being displayed correctly.
** DONE Lightbox is a bit temperemental at the moment.
** DONE KeyError in fslviewframe when control panels are removed
** DONE elistbox labels not shown?
** DONE elistbox throwing errors randomly.
** DONE gl21 - Voxel opacity when sampling rate > 1 is not correct.
** DONE Image not updating/redrawing properly on transform matrix change
** DONE Control panels no longer persistent across restarts?
** DONE JALAPENO - Image List background colour no worky
** DONE JALAPENO - LightBoxCanvas mouse scroll no worky
** DONE gl14 - Transparent voxels are green ?!?
** DONE Non-FSLView tools are broken due to fsl.py Panel->Frame changes
** DONE LocationPanel volume bounds.
** DONE Fix cursors - they go off the canvas in some cases
** DONE LightBoxCanvas bounding box calculation is broken again.
** DONE SliceCanvas bounding box calculation is also broken again.
** DONE Fix mouse tracking (voxel changes)
** DONE Transformation matrix recursion is happening again, for Ludo's file with the bad affine.
** DONE Selected image sync between all the control panels is a bit iffy
** DONE Cursor location on lightboxcanvas, when Z is not the depth axis
** DONE Voxel location widgets not updating properly when image is changed
** DONE Min z distance on lightboxcanvas not working?
** DONE OSX SegFault when all view tabs removed??
** DONE Graceful handling of bad input filenames
** DONE Aspect ratio on slicecanvas zoom, and panning is broken.
* Little things
** ColourBarPanel should only do stuff if it is being displayed
** Arrow keys on image list change selected image
** 'Centre view' option on slice canvases
** Props package - add a setting on HasProperties instances to allow validation of all properties to be disabled for instances which don't need it (see comments at properties.py:264).
** Optimisations - tune image._transform, and glimage.genVertexData functions. Go back to using triangle strips?
** Get rid of imagefile module, put functionality in image module.
** View/view config panels persist across shutdown/restart
This is tough, because the old agw.AUINotebook implementation does not have
any ability to query layout.
** Ability to edit image affine transformation...
Actually, why not just a nifti header editor?  Another idea - interactive
editing of the affine transform - click, drag, scale, rotate, etc. I think
I've had this idea before
** 'Create mask image' option
** 'Mask' image type
** 'Outline' image type
** Make display range limit-edit-widget less crappy.
** Improve colour bar
*** ColourBarCanvas - make it smarter
Display either the cbar for the current image, or cbars for all images. 
'Stacking' of multipl cbars - stack cbars along the main axis, or along the secondary axi
*** Better layout
*** Multiple/customisable ticks
*** Adjustable font size
*** DONE Tick label floating point formatting
*** DONE Remove white gap on max side of colour bar
** IN PROGRESS 'Actions'? - Make 'Add File' and 'Add Std' menu items actions.
Need to be able to specify the order that actions appear in the menu - perhaps 
just hard code in fsl/fslview/actions/__init__.py
** DONE Orientation labels on slice canvas.
** DONE Display image space code in cursor panel
** DONE Turn your test_gl14_coords.py script into a fslview ViewPanel; it might come in handy.
** DONE Grid line option on lightbox canvas
** DONE Newly loaded image is selected 
** DONE Add Standard  -> put image at bottom of list
** DONE render.py supports ortho/lightbox command line configuration
** DONE Background colour option in render.py
** DONE Refactor slicecanvas_draw/lightboxcanvas_draw modules - loads of duplicate code that can probably be put in the GL-version independent modules.
** DONE Refactor wxglslicecanvas/wxgllightboxcanvas - duplicate code... ?
** DONE Make ColourBarPanel generic.
** DONE Remove duplicate argument parsing code between tools/render.py and tools/fslview.py
** DONE Why is the SliceCanvas responsible for creating GL contexts?
Maybe I should define a 'GLManager' which has a bunch of methods on it
(e.g. create context, set current, etc), and is passed to all the GL things
that need it (e.g. SliceCanvas, LightBoxCanvas, etc)
** DONE Make ColourBarPanel superclass/mixin thingo, so we can use it in LightBoxPanel as well as OrthoPanel.
** DONE Come up with a nicer way of specifying short CLI argument characters for fslview/render properties
** DONE Don't draw LightBoxCanvas cursor when out of Z range
** DONE Make fsl.py support non-GUI tools.
** DONE Colour bar showing image value range
** DONE Make image list navigator widget listen to image name changes.
** DONE Spline interpolation
** DONE Ability to change selected image in image display and cursor location panels.
** DONE Disable/enable next/prev buttons on elistbox and imageselect panel as necessary.
** WONTFIX Cursor location preservation when transformation option is changed. The world location is preserved.
** DONE Set cursor location via command line option.
** DONE Cursor bound restriction on ortho panel.
** DONE Refactor/merge GL14<->Gl21 image data code, as there is a lot of shared functionality.
** DONE Rethink 4D handling - image.display.volume or imageList.volume?
** DONE Clip Low/Clip High display options
** DONE Clear image names on location panel and image display panel when image list is empty.
** DONE Interpolation option when displaying in real world space
** DONE Use GL_UNPACK_ALIGNMENT to avoid the need to pad texture images.
** DONE Superclasses for view/control panels.
** DONE Separate display properties from fsl.data.fslimage classes? A separate fsl.fslview.displaycontext module?
** DONE Named view panels
** DONE View config panels should be dockable.
** DONE Focus/display newly opened view tabs
** DONE Display current location on new lightboxcanvas, and when light box props change
** DONE Truncate long filenames in image list panel.
** DONE Labels for individual bound/point widget sliders.
** DONE Vertically center widget property labels.
** DONE Fix image bounds calculation (for images with dodgy affines)
** DONE Constraint listener on Lists which is notified of changes to constraints on any of the items in the list
** DONE 'Add standard'/'Add Atlas' menu options.
** DONE Update LightBoxCanvas properties - check out funny behaviour in ncols.
** DONE Pan in LightBoxCanvas, so currently selected location is always on screen.
** DONE Min distance for LightBoxCanvas.zrange.
** DONE If image files were specified on the command line, make sure the open file dialog defaults to one of their paths.
** DONE Float formatting on range slider buttons
** DONE Enable/disable ImageList<->Canvas position sync - 'link' property on slice canvas/orthopanel, or something.
** DONE SliceCanvas initial location set from image list
* Medium things
** Profiles (e.g. 'view', 'edit', 'analyse?', etc etc). 
This will probably dictate how you go about implementing keyboard/mouse control
** Keyboard/mouse control
*** Arrow keys to move cursor location - how to select which x/y axes are controlled?
*** Mouse/keyboard controls for panning/zooming
** Link display properties across all images
** Tensors
*** RGB display
*** Tensor angles are in real world space, so are currently being displayed incorrectly for non isotropic voxels 
*** Option to make displayed tensor lines all the same length
*** 'Modulate' one image by another (e.g. modulate DTI tensors by FA values)
*** Option to show tensors as ellipsoids
** Display fnirt warp images
** IN PROGRESS Image export/offscreen rendering.
** DONE Image List functionality
*** DONE double click to show/hide
*** DONE Edit image name
*** DONE Highlight enabled/disabled images
** DONE Custom colour maps from original FSLView
** DONE Command line interface - build into props package?
** DONE Remove voxel<->world orthogonality requirement
** DONE Make slice canvas bounding box calculation more intelligent when zoom > 1.
** DONE separate out props and gui packages - they should really be separate projects
** DONE location panel (information about currently selected location) - add a 'location' property to the imagelist so we can link across different views.
** DONE Location selection on LightBoxCanvas.
* Big/ambiguous things
** Test suite for props package
** Code audit - enforce consistent standards for public/private class members
** image editing (e.g. selecting, erasing, filling, mask creation)
** Surface display. Who does surface stuff?
** 3D. People do use 3D mode in the original FSLView, so we should have the capability.
** Other data - Diffusion. Talk to Saad and Manu.
** IN PROGRESS time series plotting option
** IN PROGRESS Standard for code documentation - Sphinx.
** DONE OpenGL 1.4 implementation - required for running over SSH/VNC.
** DONE have multiple views open - look at wxAUI.
* Other ideas
** (Saad).   Select regions by colour, for editing purposes
** (Eugene). Perhaps some useful viewing functionality would be a helper viewer to explore high-level (gfeat) analyses directories - simple browsing tools for quickly loading and unloading stats files, contrasts etc.  Then it might move to be able to link to lower level dirs.  Pretty much like a viewer version of the webpage reports.
** (Mark).   That colourmaps for label images (e.g. HarvardOxford subcortical) uses the display range info rather than totally ignores it.  I'd like to be able to threshold away some structures using the display range, but at the moment that cannot be done.
** (Mark).   The ability to have separate display ranges for different volumes in one 4D image (maybe only when automatically calculated?) which would be especially useful for diffusion series where the b=0 images are way brighter than the others when using the same display range.
** (Ludo).   Automatic cluster size thresholding (e.g. Z threshold/cluster size)
** (Paul).   Slice-wise (instead of image-wise) glimagedata implementation for very large images.
** (Paul).   Statistics/info panel (e.g. mean/med/std/volume size/etc).
** (Manu).   Statistics (e.g. histogram) on hand-selected ROIs.
** (Ged).    Multiple colour bars
Perhaps instead of having the colour bar as an (e.g.) OrthoPanel property, I
could create a new ViewPanel which allows the user to configure for which
images a colour bar should be displayed. Or I could have a 'showColourBar' property
on the image display object.
** (Ged).    Colouring of unions/intersections for combinations of mask images
** (Fidel).  Diffusion data - show acquisition direction for each volume (from bvec text file) when displaying raw diffusion data. Could have a little display (a separate ViewPanel) which has a 3D compass-like thing.
** (Ged).    Intensity contour lines (cool idea!).
** (Ged).    First/third angle orthographic projection. Related, should I be displaying each slice canvas at the same scale? Currently they are simply sized to use the maximum available space.. 
** (Paul).   Image groups - may make life easier for grouping images which belong together for analysis purposes.
